<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>LearnCOBOL - Online COBOL Learning Platform</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta content="" name="keywords">
    <meta content="" name="description">

    <!-- Favicon -->
    <link href="img/favicon.ico" rel="icon">

    <!-- Google Web Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@400;500;600&family=Nunito:wght@600;700;800&display=swap" rel="stylesheet">

    <!-- Icon Font Stylesheet -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css" rel="stylesheet">

    <!-- Libraries Stylesheet -->
    <link href="lib/animate/animate.min.css" rel="stylesheet">

    <!-- Customized Bootstrap Stylesheet -->
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <!-- Template Stylesheet -->
    <link href="css/style.css" rel="stylesheet">

    <!-- Auth Stylesheet -->
    <link href="css/auth.css" rel="stylesheet">

    <!-- Navigation Bar Stylesheet -->
    <link href="css/nav.css" rel="stylesheet">
</head>

<body>
    <!-- Navigation Bar -->
    <nav id="navigation">
        <ul>
            <li><a href="index.html">Home</a></li>
            <li><a href="course.html">Practice</a></li>
            <li><a href="learn.html">Learn</a></li>
            <li style="float:right"><button id="manageAccountBtn" class="btn btn-primary">Manage</button></li>
        </ul>
    </nav>

    <!-- Hero Section Start -->
    <div class="container-fluid p-0 mb-5">
        <div class="position-relative">
            <img class="img-fluid w-100" src="jpg/carousel-1.jpg" alt="">
            <div class="position-absolute top-0 start-0 w-100 h-100 d-flex align-items-center" style="background: rgba(24, 29, 56, .7);">
                <div class="container">
                    <div class="row justify-content-start">
                        <div class="col-sm-10 col-lg-8">
                            <h5 class="text-primary text-uppercase mb-3 animated slideInDown">100 days of COBOL</h5>
                            <h1 class="display-3 text-white animated slideInDown">Learn COBOL</h1>
                            <p class="fs-5 text-white mb-4 pb-2">Face 100+ programming challenges of varying difficulty (easy, medium, hard) 
                                
                                 </p>
                            <div id="userInfo" style="display: none;">
                                <h3 class="text-white">Welcome, <span id="userName"></span>!</h3>
                                <button id="logoutBtn" class="btn btn-light">Logout</button>
                            </div>
                            <a href="#auth-section" class="btn btn-primary py-md-3 px-md-5 me-3 animated slideInLeft">Get Started</a>
                            <a href="course.html" class="btn btn-light py-md-3 px-md-5 animated slideInRight">Start Challenges</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Hero Section End -->

    <!-- Authentication Section Start -->
    <div id="auth-section" class="container py-5">
        <div class="row justify-content-center">
            <div class="col-lg-5">
                <h2 class="text-center mb-4">Login</h2>
                <form id="loginForm" class="mb-5">
                    <div class="mb-3">
                        <input type="email" class="form-control" id="loginEmail" placeholder="Enter your email" required>
                    </div>
                    <div class="mb-3">
                        <input type="password" class="form-control" id="loginPassword" placeholder="Enter your password" required>
                    </div>
                    <div class="mb-3 form-check">
                        <input type="checkbox" class="form-check-input" id="showLoginPassword">
                        <label class="form-check-label" for="showLoginPassword">Show password</label>
                    </div>
                    <div id="loginError" class="alert alert-danger d-none" role="alert"></div>
                    <button type="submit" class="btn btn-primary w-100">
                        <span class="spinner-border spinner-border-sm d-none" role="status" aria-hidden="true"></span>
                        Login
                    </button>
                </form>
                <div class="text-center">
                    <p>Don't have an account?</p>
                    <button id="showSignUpBtn" class="btn btn-secondary">Sign Up</button>
                </div>
            </div>
        </div>
    </div>
    <!-- Authentication Section End -->

    <!-- Sign Up Section Start -->
    <div id="signup-section" class="container py-5" style="display: none;">
        <div class="row justify-content-center">
            <div class="col-lg-5">
                <h2 class="text-center mb-4">Sign Up</h2>
                <form id="signupForm" class="mb-5">
                    <div class="mb-3">
                        <input type="text" class="form-control" id="signupName" placeholder="Enter your name" required>
                    </div>
                    <div class="mb-3">
                        <input type="email" class="form-control" id="signupEmail" placeholder="Enter your email" required>
                    </div>
                    <div class="mb-3">
                        <input type="password" class="form-control" id="signupPassword" placeholder="Enter your password" required>
                    </div>
                    <div class="mb-3">
                        <input type="password" class="form-control" id="signupConfirmPassword" placeholder="Confirm your password" required>
                    </div>
                    <div class="mb-3 form-check">
                        <input type="checkbox" class="form-check-input" id="showSignupPassword">
                        <label class="form-check-label" for="showSignupPassword">Show password</label>
                    </div>
                    <div id="signupError" class="alert alert-danger d-none" role="alert"></div>
                    <button type="submit" class="btn btn-primary w-100">Sign Up</button>
                </form>
                <div class="text-center">
                    <p>Already have an account?</p>
                    <button id="showLoginBtn" class="btn btn-secondary">Login</button>
                </div>
            </div>
        </div>
    </div>
    <!-- Sign Up Section End -->

    <!-- JavaScript Libraries -->
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="lib/wow/wow.min.js"></script>
    <script src="lib/easing/easing.min.js"></script>

    <!-- Firebase App (the core Firebase SDK) is always required and must be listed first -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

    <!-- Template Javascript -->
    <script>
        // Initialize Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyCRG4zTvQatqvgz46nTXXao0-qSWr5u3gA",
            authDomain: "learncobol-452ff.firebaseapp.com",
            projectId: "learncobol-452ff",
            storageBucket: "learncobol-452ff.appspot.com",
            messagingSenderId: "785464884209",
            appId: "1:785464884209:web:d4ed745c0d8571ac322250",
            measurementId: "G-7QVF8EY1NT"
        };

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();

        // Get references to the forms and buttons
        const loginForm = document.getElementById('loginForm');
        const signupForm = document.getElementById('signupForm');
        const showSignUpBtn = document.getElementById('showSignUpBtn');
        const showLoginBtn = document.getElementById('showLoginBtn');
        const logoutBtn = document.getElementById('logoutBtn');
        const navigation = document.getElementById('navigation');

        // Get references to password fields and show password checkboxes
        const loginPassword = document.getElementById('loginPassword');
        const signupPassword = document.getElementById('signupPassword');
        const signupConfirmPassword = document.getElementById('signupConfirmPassword');
        const showLoginPassword = document.getElementById('showLoginPassword');
        const showSignupPassword = document.getElementById('showSignupPassword');

        // Add event listeners
        loginForm.addEventListener('submit', handleLogin);
        signupForm.addEventListener('submit', handleSignup);
        showSignUpBtn.addEventListener('click', showSignupSection);
        showLoginBtn.addEventListener('click', showLoginSection);
        logoutBtn.addEventListener('click', handleLogout);
        
        const manageAccountBtn = document.getElementById('manageAccountBtn');
        manageAccountBtn.addEventListener('click', handleManageAccount);

        // Add event listeners for show password functionality
        showLoginPassword.addEventListener('change', () => togglePasswordVisibility(loginPassword, showLoginPassword));
        showSignupPassword.addEventListener('change', () => {
            togglePasswordVisibility(signupPassword, showSignupPassword);
            togglePasswordVisibility(signupConfirmPassword, showSignupPassword);
        });

        // Function to toggle password visibility
        function togglePasswordVisibility(passwordField, checkbox) {
            passwordField.type = checkbox.checked ? 'text' : 'password';
        }

        // Function to update UI based on authentication state
        function updateUI(user) {
            if (user) {
                document.getElementById('userName').textContent = user.displayName || user.email;
                document.getElementById('userInfo').style.display = 'block';
                document.getElementById('auth-section').style.display = 'none';
                document.getElementById('signup-section').style.display = 'none';
                navigation.style.display = 'block';
            } else {
                document.getElementById('userInfo').style.display = 'none';
                document.getElementById('auth-section').style.display = 'block';
                navigation.style.display = 'none';
            }
        }

        // Check authentication state on page load
        firebase.auth().onAuthStateChanged((user) => {
            updateUI(user);
        });

        // Define the login event handler
        async function handleLogin(event) {
            event.preventDefault();

            // Get the email and password from the login form
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            try {
                // Sign in the user with Firebase Authentication
                await firebase.auth().signInWithEmailAndPassword(email, password);
                updateUI(firebase.auth().currentUser);
            } catch (error) {
                // Display the error message
                document.getElementById('loginError').textContent = error.message;
                document.getElementById('loginError').classList.remove('d-none');
            }
        }

        // Define the signup event handler
        async function handleSignup(event) {
            event.preventDefault();

            // Get the signup form values
            const name = document.getElementById('signupName').value;
            const email = document.getElementById('signupEmail').value;
            const password = document.getElementById('signupPassword').value;
            const confirmPassword = document.getElementById('signupConfirmPassword').value;

            // Check if passwords match
            if (password !== confirmPassword) {
                document.getElementById('signupError').textContent = 'Passwords do not match';
                document.getElementById('signupError').classList.remove('d-none');
                return;
            }

            try {
                // Create the user with Firebase Authentication
                const userCredential = await firebase.auth().createUserWithEmailAndPassword(email, password);
                // Update the user's display name
                await userCredential.user.updateProfile({
                    displayName: name
                });
                // Redirect to Stripe Checkout
                redirectToStripeCheckout();
            } catch (error) {
                // Display the error message
                document.getElementById('signupError').textContent = error.message;
                document.getElementById('signupError').classList.remove('d-none');
            }
        }

        async function handleLogout() {
            try {
                await firebase.auth().signOut();
                updateUI(null);
            } catch (error) {
                console.error('Error signing out:', error);
            }
        }

        // Function to handle Manage Account button click
        function handleManageAccount() {
            alert('Please check your initial email for account information.');
        }

        // Function to show signup section
        function showSignupSection() {
            document.getElementById('auth-section').style.display = 'none';
            document.getElementById('signup-section').style.display = 'block';
        }

        // Function to show login section
        function showLoginSection() {
            document.getElementById('auth-section').style.display = 'block';
            document.getElementById('signup-section').style.display = 'none';
        }

        // Prevent navigation away from index.html
        window.addEventListener('beforeunload', (event) => {
            if (!firebase.auth().currentUser) {
                event.preventDefault();
                event.returnValue = '';
            }
        });

        // Disable navigation links when user is not signed in
        document.querySelectorAll('a').forEach(link => {
            link.addEventListener('click', (event) => {
                if (!firebase.auth().currentUser && !link.getAttribute('href').startsWith('#')) {
                    event.preventDefault();
                    alert('Please sign in to access other pages.');
                }
            });
        });

        // Function to redirect to Stripe Checkout
        function redirectToStripeCheckout() {
            // Replace this URL with your actual Stripe Checkout link
            const stripeCheckoutUrl = 'https://buy.stripe.com/fZedRO8I34ImdRm4gg';
            window.location.href = stripeCheckoutUrl;
        }
    </script>
</body>

</html>