<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>COBOL Practice Problems</title>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  
  <link href="css/nav.css" rel="stylesheet">
  <link href="css/course.css" rel="stylesheet">
  <style>
    html {
      scroll-behavior: smooth;
    }
    .problem-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px;
      margin-bottom: 10px;
      border: 1px solid #ddd;
      border-radius: 5px;
    }
    .problem-title {
      flex-grow: 1;
      margin-right: 10px;
    }
    .difficulty {
      margin-right: 10px;
      padding: 5px 10px;
      border-radius: 3px;
      font-size: 0.8em;
    }
    .difficulty.easy { background-color: #d4edda; color: #155724; }
    .difficulty.medium { background-color: #fff3cd; color: #856404; }
    .difficulty.hard { background-color: #f8d7da; color: #721c24; }
    .solution-button {
      padding: 5px 10px;
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 3px;
      cursor: pointer;
    }
    .solution-button:hover {
      background-color: #0056b3;
    }
  </style>
</head>
<body>
  <nav>
    <ul>
      <li><a href="index.html">Home</a></li>
      <li><a href="course.html">Practice</a></li>
      <li><a href="learn.html">Learn</a></li>
    </ul>
  </nav>

  <div class="container">
    <div id="userInfo" style="display: none;">
      <span id="userName"></span>
      <button id="logoutBtn" onclick="logout()">Logout</button>
      <button id="manageAccountBtn" onclick="manageAccount()">Manage Account</button>
    </div>

    <div id="courseContent" style="display: none;">
      <h1>COBOL Practice Problems</h1>

      <div class="stats">
        <p id="total-correct"></p>
        <p id="total-easy"></p>
        <p id="total-medium"></p>
        <p id="total-hard"></p>
      </div>

      <div class="current-problem">
        <h2>Current Problem</h2>

        <h2 id="challengeTitle" class="problem-title"></h2>
        <div class="problem-item">
          <h3 id="challengeTitle" class="problem-title"></h3>
          <p id="challengeText"></p>
          <span id="challengeDifficulty" class="difficulty"></span>
          <button class="solution-button" onclick="showExpectedOutput()">Solution</button>
        </div>
        <div id="expectedOutput" class="hidden"></div>
      </div>

      <div id="controls">
        <button id="prevButton" onclick="prevChallenge()">&lt; Previous</button>
        <button id="nextButton" onclick="nextChallenge()">Next &gt;</button>
        <button id="markAsCorrectButton" onclick="markAsCorrect()">Mark as Correct</button>
        <button id="feedbackButton" onclick="openFeedbackModal()">Give Feedback</button>
        <button id="stripeButton" onclick="buyMeCoffee()">Buy me a coffee</button>
      </div>

      <div data-pym-src="https://www.jdoodle.com/embed/v1/86d1c02375800a77"></div>
      <script src="https://www.jdoodle.com/assets/jdoodle-pym.min.js" type="text/javascript"></script>
      <div id="outputResult"></div>
      <div id="answerResult"></div>

      <h2>All Challenges</h2>
      <ul id="challengeList" class="problem-list">
        <!-- Challenge list will be populated by JavaScript -->
      </ul>
    </div>
  </div>

  <div id="feedbackModal" class="modal">
    <div class="modal-content">
      <span class="close">&times;</span>
      <h2>Provide Feedback</h2>
      <iframe src="https://forms.gle/kc7oZU43AGNdTurv6" width="100%" height="500" frameborder="0" marginheight="0" marginwidth="0">Loadingâ€¦</iframe>
    </div>
  </div>
 
  <script src="js/main.js"></script>
  <script>
    const challengeTitleElement = document.getElementById('challengeTitle');
    const challengeTextElement = document.getElementById('challengeText');  
    const challengeDifficultyElement = document.getElementById('challengeDifficulty');
    const outputResultElement = document.getElementById('outputResult');
    const answerResultElement = document.getElementById('answerResult');
    const nextButtonElement = document.getElementById('nextButton');
    const prevButtonElement = document.getElementById('prevButton');
    const showExpectedOutputButtonElement = document.querySelector('.solution-button');
    const markAsCorrectButtonElement = document.getElementById('markAsCorrectButton');
    const expectedOutputElement = document.getElementById('expectedOutput');
    const challengeListElement = document.getElementById('challengeList');
   
    // Load challenges
    const challenges = [
      {
        id: 1,
        title: 'Hello World',
        text: "Write a COBOL program that displays 'Hello World'.",
        expectedOutput: 'Hello World',
        isCorrect: false,
        difficulty: 'Easy'
      },
      {
        id: 2,
        title: 'Basic Sum',
        text: 'Write a COBOL program that calculates the sum of two numbers: 25 and 30. It should print "The sum is <r>".',
        expectedOutput: 'The sum is 55',
        isCorrect: false,
        difficulty: 'Easy'
      }
    ];

    let currentChallengeIndex = 0;

    function getCurrentChallenge() {
      return challenges[currentChallengeIndex];
    }

    function displayChallenge() {
      const challenge = getCurrentChallenge();
      if (challenge) {
        challengeTitleElement.textContent = challenge.title;
        challengeTextElement.textContent = challenge.text;
        challengeDifficultyElement.textContent = challenge.difficulty;
        challengeDifficultyElement.className = `difficulty ${challenge.difficulty.toLowerCase()}`;
        markAsCorrectButtonElement.setAttribute('data-question-id', challenge.id);
        
        updateChallengeUI(challenge);
        
        expectedOutputElement.textContent = '';
        expectedOutputElement.classList.add('hidden');
      } else {
        challengeTitleElement.textContent = 'No challenges available';
        challengeTextElement.textContent = '';
        challengeDifficultyElement.textContent = '';
        markAsCorrectButtonElement.setAttribute('data-question-id', '');
      }
    }

    function nextChallenge() {
      currentChallengeIndex++;

      if (currentChallengeIndex < challenges.length) {
        displayChallenge();
        outputResultElement.textContent = "";
        answerResultElement.textContent = "";
        prevButtonElement.disabled = false;
      } else {
        nextButtonElement.disabled = true;
      }
    }

    function prevChallenge() {
      currentChallengeIndex--;

      if (currentChallengeIndex >= 0) {
        displayChallenge();
        outputResultElement.textContent = "";
        answerResultElement.textContent = "";
        nextButtonElement.disabled = false;
      } else {
        currentChallengeIndex = 0;
        prevButtonElement.disabled = true;
      }
    }

    function showExpectedOutput() {
      const challenge = getCurrentChallenge();
      if (challenge) {
        expectedOutputElement.textContent = 'Expected Output: ' + challenge.expectedOutput;
        expectedOutputElement.classList.remove('hidden');
      }
    }

    function markAsCorrect() {
      alert("Warning: Dishonest answers and users may be removed. Ensure you're solving the challenges honestly.");
      const currentChallenge = getCurrentChallenge();
      if (currentChallenge) {
        markAsCorrectFunction(currentChallenge.id);
        updateChallengeUI(currentChallenge);
        updateChallengeListColors();
        updateStatsUI();
      }
    }

    function updateChallengeListColors() {
      const listItems = challengeListElement.getElementsByTagName('li');
      for (let i = 0; i < listItems.length; i++) {
        const listItem = listItems[i];
        const challenge = challenges[i];
        listItem.classList.remove('correct', 'incorrect');
        if (isQuestionCorrect(challenge.id)) {
          listItem.classList.add('correct');
        } else {
          listItem.classList.add('incorrect');
        }
      }
    }

    window.addEventListener('message', function(e) {
      if (e.data && e.data.type === 'result') {
        const output = e.data.output;
        outputResultElement.textContent = "Output: " + output;
      }
    }, false);

    // Populate the challenge list
    function populateChallengeList() {
      challengeListElement.innerHTML = ''; // Clear existing list
      challenges.forEach((challenge, index) => {
        const listItem = document.createElement('li');
        listItem.className = 'problem-item';
        listItem.innerHTML = `
          <span class="problem-title">Challenge ${challenge.id}: ${challenge.title}</span>
          <div>
            <span class="difficulty ${challenge.difficulty.toLowerCase()}">${challenge.difficulty}</span>
            <button class="solution-button" onclick="showSolution(${index})">Solution</button>
          </div>
        `;
        listItem.addEventListener('click', () => {
          currentChallengeIndex = index;
          displayChallenge();
          // Scroll to the top of the page
          window.scrollTo({
            top: 0,
            behavior: 'smooth'
          });
        });
        challengeListElement.appendChild(listItem);
      });
    }

    function showSolution(index) {
      const challenge = challenges[index];
      alert(`Expected Output: ${challenge.expectedOutput}`);
    }

    function calculateStats(challenges) {
      const totalChallenges = challenges.length;
      const correctChallenges = challenges.filter(challenge => isQuestionCorrect(challenge.id)).length;
      const percentageCorrect = ((correctChallenges / totalChallenges) * 100).toFixed(2);
      const totalEasy = challenges.filter(challenge => challenge.difficulty === 'Easy').length;
      const totalMedium = challenges.filter(challenge => challenge.difficulty === 'Medium').length;
      const totalHard = challenges.filter(challenge => challenge.difficulty === 'Hard').length;
      const correctEasy = challenges.filter(challenge => challenge.difficulty === 'Easy' && isQuestionCorrect(challenge.id)).length;
      const correctMedium = challenges.filter(challenge => challenge.difficulty === 'Medium' && isQuestionCorrect(challenge.id)).length;
      const correctHard = challenges.filter(challenge => challenge.difficulty === 'Hard' && isQuestionCorrect(challenge.id)).length;

      return {
        total: totalChallenges,
        correct: correctChallenges,
        percentage: percentageCorrect,
        Easy: { total: totalEasy, correct: correctEasy },
        Medium: { total: totalMedium, correct: correctMedium },
        Hard: { total: totalHard, correct: correctHard }
      };
    }

    function updateStatsUI() {
      const stats = calculateStats(challenges);
      document.getElementById('total-correct').innerText = `Total Correct: ${stats.correct} out of ${stats.total}`;
      document.getElementById('total-easy').innerText = `Easy: ${stats.Easy.correct} out of ${stats.Easy.total}`;
      document.getElementById('total-medium').innerText = `Medium: ${stats.Medium.correct} out of ${stats.Medium.total}`;
      document.getElementById('total-hard').innerText = `Hard: ${stats.Hard.correct} out of ${stats.Hard.total}`;
    }

    function logout() {
      firebase.auth().signOut().then(() => {
        window.location.href = 'index.html';
      }).catch((error) => {
        console.error('Error signing out:', error);
      });
    }

    function manageAccount() {
      // Implement account management functionality
     // alert('Account management functionality not implemented yet.');
    }

    function buyMeCoffee() {
      // Implement "Buy me a coffee" functionality
      //alert('Thank you for considering buying me a coffee! This functionality is not implemented yet.');
    }

    // Check authentication state and initialize the page
    firebase.auth().onAuthStateChanged(function(user) {
      if (user) {
        document.getElementById('userInfo').style.display = 'block';
        document.getElementById('courseContent').style.display = 'block';
        document.getElementById('userName').textContent = user.displayName;

        populateChallengeList();
        updateChallengeListColors();
        displayChallenge();
        updateStatsUI();
      } else {
        window.location.href = 'index.html';
      }
    });

    // Feedback Modal Functions
    const modal = document.getElementById("feedbackModal");
    const span = document.getElementsByClassName("close")[0];

    function openFeedbackModal() {
      modal.style.display = "block";
    }

    span.onclick = function() {
      modal.style.display = "none";
    }

    window.onclick = function(event) {
      if (event.target == modal) {
        modal.style.display = "none";
      }
    }
  </script>
</body>
</html>
