<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>COBOL Code Editor and Compiler</title>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  
  <!-- Navigation Bar Stylesheet -->
  <link href="css/nav.css" rel="stylesheet">
  
  <!-- Custom Video Game Font -->
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">

  <style>
    body {
      font-family: 'Press Start 2P', cursive;
      background: linear-gradient(45deg, #1a1a2e, #16213e);
      color: #e94560;
    }
    #nextButton, #showExpectedOutputButton, #markAsCorrectButton, #prevButton, #stripeButton {
      margin-bottom: 40px;
      margin-right: 10px;
      background: linear-gradient(45deg, #0f3460, #e94560);
      border: none;
      color: #fff;
      padding: 10px 20px;
      border-radius: 5px;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    #nextButton:hover, #showExpectedOutputButton:hover, #markAsCorrectButton:hover, #prevButton:hover, #stripeButton:hover {
      transform: translateY(-3px);
      box-shadow: 0 5px 15px rgba(233, 69, 96, 0.4);
    }
    .hidden {
      display: none;
    }
    .correct {
      color: #00ff00;
      text-shadow: 0 0 5px #00ff00;
    }
    .incorrect {
      color: #ff0000;
      text-shadow: 0 0 5px #ff0000;
    }
    #challengeList li {
      cursor: pointer;
      padding: 10px;
      margin: 5px 0;
      background: rgba(15, 52, 96, 0.5);
      border-radius: 5px;
      transition: all 0.3s ease;
    }
    #challengeList li:hover {
      background: rgba(233, 69, 96, 0.3);
      transform: translateX(5px);
    }
    #challengeList li.correct {
      background: rgba(0, 255, 0, 0.2);
    }
    #challengeList li.incorrect {
      background: rgba(255, 0, 0, 0.2);
    }
    .difficulty {
      font-weight: bold;
      margin-left: 10px;
      padding: 3px 6px;
      border-radius: 3px;
    }
    .Easy { background-color: #4CAF50; color: #fff; }
    .Medium { background-color: #FFC107; color: #000; }
    .Hard { background-color: #F44336; color: #fff; }
    #challengeText, #challengeDifficulty {
      background: rgba(15, 52, 96, 0.3);
      padding: 20px;
      border-radius: 10px;
      margin-bottom: 20px;
    }
    #expectedOutput, #outputResult, #answerResult {
      background: rgba(233, 69, 96, 0.1);
      padding: 15px;
      border-radius: 5px;
      margin-top: 20px;
      border: 1px solid #e94560;
    }
    .stats {
      display: flex;
      justify-content: space-around;
      flex-wrap: wrap;
      margin-bottom: 30px;
    }
    .stats p {
      background: rgba(15, 52, 96, 0.3);
      padding: 10px;
      border-radius: 5px;
      margin: 5px;
      flex: 1;
      text-align: center;
    }
  </style>
</head>
<body>
  <!-- Navigation Bar -->
  <nav>
    <ul>
      <li><a href="index.html">Home</a></li>
      <li><a href="course.html">Practice</a></li>
      <li><a href="learn.html">Learn</a></li>
    </ul>
  </nav>

  <div id="userInfo" style="display: none;margin-top: 70px;">
    <span id="userName"></span>
    <button id="logoutBtn">Logout</button>
    <button id="manageAccountBtn">Manage Account</button>
  </div>

  <div id="courseContent" style="display: none;">
    <h1 style="margin-top: 10px; text-align: center; color: #e94560; text-shadow: 0 0 10px #e94560;">Question Bank</h1>

    <h2>Your Statistics:</h2>

    <div class="stats">
      <p id="total-correct"></p>
      <p id="percentage-correct"></p>
      <p id="total-easy"></p>
      <p id="total-medium"></p>
      <p id="total-hard"></p>
    </div>

    <h2>Question:</h2>

    <div id="challengeText" style="font-size: 1.6em; color: #fff; margin-bottom: 20px;"></div>

    <div id="challengeDifficulty" style="font-size: 1em; color: #fff; margin-bottom: 20px;"></div>

    
    <button id="prevButton" onclick="prevChallenge()">&lt;</button>
    <button id="nextButton" onclick="nextChallenge()">&gt;</button>

    <button id="showExpectedOutputButton" onclick="showExpectedOutput()">Show Expected Output</button>
    <button id="markAsCorrectButton" onclick="markAsCorrect()">Mark as Correct</button>

    <!-- Updated Stripe button -->
    <button id="stripeButton" onclick="redirectToStripePage()">Buy me a coffee</button>

    <div id="expectedOutput" class="hidden"></div>
    <div data-pym-src="https://www.jdoodle.com/embed/v1/86d1c02375800a77"></div>
    <script src="https://www.jdoodle.com/assets/jdoodle-pym.min.js" type="text/javascript"></script>
    <div id="outputResult"></div>
    <div id="answerResult"></div>

    <h3>All Challenges</h3>
    <ul id="challengeList"></ul>
  </div>
 
  <script src="js/main.js"></script>
  <script>
    const challengeTextElement = document.getElementById('challengeText');
    const challengeDifficultyElement = document.getElementById('challengeDifficulty');
    const outputResultElement = document.getElementById('outputResult');
    const answerResultElement = document.getElementById('answerResult');
    const nextButtonElement = document.getElementById('nextButton');
    const prevButtonElement = document.getElementById('prevButton');
    const showExpectedOutputButtonElement = document.getElementById('showExpectedOutputButton');
    const markAsCorrectButtonElement = document.getElementById('markAsCorrectButton');
    const expectedOutputElement = document.getElementById('expectedOutput');
    const challengeListElement = document.getElementById('challengeList');
   
    // Load challenges
    const challenges = [
      {
        id: 1,
        text: 'Write a COBOL program that prints "Hello, World!" to the console.',
        expectedOutput: 'Hello, World!',
        isCorrect: false,
        difficulty: 'Easy'
      },
      {
    id: 2,
    text: 'Write a COBOL program that calculates the sum of two numbers: 25 and 30. It should print "The sum is <r>".',
    expectedOutput: 'The sum is 55',
    isCorrect: false,
    difficulty: 'Easy'
  },
    ];

    let currentChallengeIndex = 0;

    function getCurrentChallenge() {
      return challenges[currentChallengeIndex];
    }

    function displayChallenge() {
      const challenge = getCurrentChallenge();
      challengeTextElement.textContent = challenge.text;
      challengeDifficultyElement.textContent = `Difficulty: ${challenge.difficulty}`;
      challengeDifficultyElement.className = `difficulty ${challenge.difficulty}`;
      markAsCorrectButtonElement.setAttribute('data-question-id', challenge.id);
      
      updateChallengeUI(challenge);
      
      expectedOutputElement.textContent = '';
      expectedOutputElement.classList.add('hidden');
    }

    function nextChallenge() {
      currentChallengeIndex++;

      if (currentChallengeIndex < challenges.length) {
        displayChallenge();
        outputResultElement.textContent = "";
        answerResultElement.textContent = "";
        prevButtonElement.disabled = false;
      } else {
        nextButtonElement.disabled = true;
      }
    }

    function prevChallenge() {
      currentChallengeIndex--;

      if (currentChallengeIndex >= 0) {
        displayChallenge();
        outputResultElement.textContent = "";
        answerResultElement.textContent = "";
        nextButtonElement.disabled = false;
      } else {
        currentChallengeIndex = 0;
        prevButtonElement.disabled = true;
      }
    }

    function showExpectedOutput() {
      const challenge = getCurrentChallenge();
      expectedOutputElement.textContent = 'Expected Output: ' + challenge.expectedOutput;
      expectedOutputElement.classList.remove('hidden');
    }

    function markAsCorrect() {
      alert("Warning: Dishonest answers and users may be removed. Ensure you're solving the challenges honestly.");
      const currentChallenge = getCurrentChallenge();
      markAsCorrectFunction(currentChallenge.id);
      updateChallengeUI(currentChallenge);
      updateChallengeListColors();
      updateStatsUI();
    }

    function updateChallengeListColors() {
      const listItems = challengeListElement.getElementsByTagName('li');
      for (let i = 0; i < listItems.length; i++) {
        const listItem = listItems[i];
        const challenge = challenges[i];
        listItem.classList.remove('correct', 'incorrect');
        if (isQuestionCorrect(challenge.id)) {
          listItem.classList.add('correct');
        } else {
          listItem.classList.add('incorrect');
        }
      }
    }

    window.addEventListener('message', function(e) {
      if (e.data && e.data.type === 'result') {
        const output = e.data.output;
        outputResultElement.textContent = "Output: " + output;
      }
    }, false);

    // Populate the challenge list
    challenges.forEach((challenge, index) => {
      const listItem = document.createElement('li');
      listItem.innerHTML = `${index + 1}. ${challenge.text} <span class="difficulty ${challenge.difficulty}">(${challenge.difficulty})</span>`;
      listItem.addEventListener('click', () => {
        currentChallengeIndex = index;
        displayChallenge();
      });
      challengeListElement.appendChild(listItem);
    });

    function calculateStats(challenges) {
      const totalChallenges = challenges.length;
      const correctChallenges = challenges.filter(challenge => isQuestionCorrect(challenge.id)).length;
      const percentageCorrect = ((correctChallenges / totalChallenges) * 100).toFixed(2);
      const totalEasy = challenges.filter(challenge => challenge.difficulty === 'easy' && isQuestionCorrect(challenge.id)).length;
      const totalMedium = challenges.filter(challenge => challenge.difficulty === 'medium' && isQuestionCorrect(challenge.id)).length;
      const totalHard = challenges.filter(challenge => challenge.difficulty === 'hard' && isQuestionCorrect(challenge.id)).length;

      return {
        total: totalChallenges,
        correct: correctChallenges,
        percentage: percentageCorrect,
        Easy: totalEasy,
        Medium: totalMedium,
        Hard: totalHard
      };
    }

    function updateStatsUI() {
      const stats = calculateStats(challenges);
      document.getElementById('total-correct').innerText = `Total Correct: ${stats.correct} out of ${stats.total} (${stats.percentage}%)`;
      
      //document.getElementById('total-easy').innerText = `Easy Challenges: ${stats.Easy}`;
      //document.getElementById('total-medium').innerText = `Medium Challenges: ${stats.Medium}`;
      //document.getElementById('total-hard').innerText = `Hard Challenges: ${stats.Hard}`;
    }

    // Check authentication state and initialize the page
    firebase.auth().onAuthStateChanged(function(user) {
      if (user) {
        document.getElementById('userInfo').style.display = 'block';
        document.getElementById('courseContent').style.display = 'block';
        document.getElementById('userName').textContent = user.displayName;

        updateChallengeListColors();
        displayChallenge();
        updateStatsUI();
      } else {
        window.location.href = 'index.html';
      }
    });
  </script>
</body>
</html>
